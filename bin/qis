#!/usr/bin/env php
<?php
/**
 * qis command line runner
 *
 * @package Qis
 */

namespace Qis;

date_default_timezone_set('America/Chicago');

$root = realpath(dirname(dirname(__FILE__)));

// Composer autoload require guard
if (!file_exists($root . DIRECTORY_SEPARATOR . 'vendor/autoload.php')) {
   die("You must run the command `composer install` from the terminal in the directory '$root' before activating this plugin.\n");
}

$autoload = require_once $root . DIRECTORY_SEPARATOR . 'vendor/autoload.php';
$autoload->set('Qis', array($root . DIRECTORY_SEPARATOR . 'src'));
$autoload->set('Qi_', array($root . DIRECTORY_SEPARATOR . 'lib'));

if (!function_exists('get_called_class')) {
    include_once $root . DIRECTORY_SEPARATOR . 'src/get_called_class.func.php';
}

$args = new \Qi_Console_ArgV(
    $argv,
    array(
        'arg:action' => 'Subcommand',
        'help|h'     => 'Show help',
        'direct|d'   => 'Show results directly in console',
        'verbose|v'  => 'Include more verbose output',
        'quiet|q'    => 'Print less messages',
        'version'    => 'Show version',
        'no-color'   => 'Don\'t use color output',
    )
);
$terminal = new \Qi_Console_Terminal();

$qis = new Qis($args, $terminal);
ExceptionHandler::initHandlers($qis);
$value = $qis->execute();
exit((int) $value);
