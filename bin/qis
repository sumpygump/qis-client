#!/usr/bin/env php
<?php
/**
 * qis command line runner
 *
 * @package Qis
 */

namespace Qis;

date_default_timezone_set('America/Chicago');

$root = realpath(dirname(__DIR__));

$autoloadLocations = array(
    __DIR__ . '/../../../autoload.php',
    $root . DIRECTORY_SEPARATOR . 'vendor/autoload.php'
);

foreach ($autoloadLocations as $file) {
    if (file_exists($file)) {
        define('QIS_COMPOSER_AUTOLOAD', $file);
        break;
    }
}

// Composer autoload require guard
if (!defined('QIS_COMPOSER_AUTOLOAD')) {
    die(
        "You must run the command `composer install` from the terminal "
        . "in the directory '$root' before using this tool.\n"
    );
}

$autoload = require_once QIS_COMPOSER_AUTOLOAD;

if (!function_exists('get_called_class')) {
    include_once $root . DIRECTORY_SEPARATOR . 'src/get_called_class.func.php';
}

$args = new \Qi_Console_ArgV(
    $argv,
    array(
        'arg:action' => 'Subcommand',
        'help|h'     => 'Show help',
        'direct|d'   => 'Show results directly in console',
        'verbose|v'  => 'Include more verbose output',
        'quiet|q'    => 'Print less messages',
        'version'    => 'Show version',
        'no-color'   => 'Don\'t use color output',
    )
);
$terminal = new \Qi_Console_Terminal();

$qis = new Qis($args, $terminal);
ExceptionHandler::initHandlers($qis);
$value = $qis->execute();
exit((int) $value);
